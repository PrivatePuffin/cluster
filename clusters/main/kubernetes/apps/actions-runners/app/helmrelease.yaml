# yaml-language-server: $schema=https://kubernetes-schemas.pages.dev/helm.toolkit.fluxcd.io/helmrelease_v2.json
apiVersion: helm.toolkit.fluxcd.io/v2
kind: HelmRelease
metadata:
    name: actions-runners
    namespace: actions-runners
spec:
    interval: 30m
    chart:
        spec:
            chart: gha-runner-scale-set
            version: 0.9.3
            sourceRef:
                kind: HelmRepository
                name: actions-runner-controller
                namespace: flux-system
    install:
        remediation:
            retries: 3
    upgrade:
        remediation:
            strategy: rollback
            retries: 3
    dependsOn:
        - name: actions-runner-controller
          namespace: actions-runner-controller
    values:
        nameOverride: ENC[AES256_GCM,data:OCyDpVKWfEPt/hZWovPa,iv:It16oi9aez8eqUf5MV4YkiA2478lAS09IkG9aOm1kY0=,tag:sQlHxJXEWo7MXakjJQERMQ==,type:str]
        runnerScaleSetName: ENC[AES256_GCM,data:3syr1jAH0S94VV3x9fxR,iv:t6bUyXC70nw4xz1TTNxAXB/zj3TcS9vSS25D3hElvTQ=,tag:df+HJsn+HtMO26CfJBJgRA==,type:str]
        minRunners: 3
        maxRunners: 12
        containerMode:
            type: dind
        githubConfigSecret:
            github_app_id: ENC[AES256_GCM,data:FcBolRJDYJmsD5bkG4L5zEF3I+JkgFgNXRBpZwbJWpJ2i9R9mhJhH1c=,iv:dE5i1m3SGCkDqKssfoC9lDWVwILzamD9X3ZzYqu4tBk=,tag:+diQeikkYCElHXex+iZrvA==,type:str]
            github_app_installation_id: ENC[AES256_GCM,data:WsQ5CIAB31o=,iv:hjlxSDS1LDnhY+tZbj1V56MOgU//irqrjXytpGnsq/E=,tag:R8XFd5fmp6cRK11s8ah/qw==,type:str]
            github_app_private_key: ENC[AES256_GCM,data:OuvqYJPrwHcIzsyMCAf1YpgLWrUJ7yTy2syPGyZA5FriJ/7AKfJ1zbFFO76KneNCRPXjDFX4RSJcoTaMRQUcwjVrsuAv7+pZVEoRggluEvOVx4xKwOtwXheSTw70R8nsjVuZHyyLbKv2yRs00ha8PpLWbaRnrYb862v9XsQePlMAQQI9Enzjx3uefVV3Chxe4L6TwCgJTjfvRShu6Q==,iv:J7GG7U6wl1YdHPNJQQWb1SyojNvs5iNNKzNC6R9zXmg=,tag:oeN8nOKAehJmUPA2F28RmA==,type:str]
        githubConfigUrl: https://github.com/truecharts
        controllerServiceAccount:
            name: actions-runner-controller
            namespace: actions-runner-controller
        template:
            spec:
                containers:
                    - name: runner
                      image: ghcr.io/truecharts/charts-ci:latest@sha256:7541472ba15b8488c54651ef028cbfc286d9a0c72fc066500ae2c6cef60ba84b
                      command:
                        - /home/runner/run.sh
                      volumeMounts:
                        - name: work
                          mountPath: /home/runner/_work
                        - name: dind-sock
                          mountPath: /var/run
                        - name: dind-externals
                          mountPath: /home/runner/externals
                    - name: dind
                      image: docker:26.0.0-dind
                      securityContext:
                        privileged: true
                      env:
                        - name: DOCKER_GROUP_GID
                          value: "568"
                      args:
                        - dockerd
                        - --host=unix:///var/run/docker.sock
                        - --group=$(DOCKER_GROUP_GID)
                        - --registry-mirror=http://spegel-registry.kube-system.svc.cluster.local:5000
                      volumeMounts:
                        - name: work
                          mountPath: /home/runner/_work
                        - name: dind-sock
                          mountPath: /var/run
                        - name: dind-externals
                          mountPath: /home/runner/externals
                volumes:
                    - name: work
                      emptyDir: {}
                    - name: dind-sock
                      emptyDir: {}
                    - name: dind-externals
                      emptyDir: {}
sops:
    shamir_threshold: 3
    kms: []
    gcp_kms: []
    azure_kv: []
    hc_vault: []
    age:
        - recipient: age1uzy27yg04slm0t4naapemy207fd7uh4lda70dxnh932e5dd8n55skgcdrq
          enc: |
            -----BEGIN AGE ENCRYPTED FILE-----
            YWdlLWVuY3J5cHRpb24ub3JnL3YxCi0+IFgyNTUxOSB4VEFxOU1oeHVtQ29yVE5Q
            MEFtUy9xamFJcGxlWjQzT05kdDhGRDQ3L1FrClVHNXg0cUNEYzAvVUl3L0R5cFhz
            dWNiOWMwOVMyM2labkxrRDJTYmY5d0EKLS0tIDdBSEFIM1BpT0w0TUxOekJpdUly
            eXhvNE5CQXhIeitsWlN4WmZXZkQ0UlUKfEQOxDA1CsCxQHBOIcxWWQaTG2cP2JeK
            msk7M7O+9WPk4AZ+AEACep2X3nnVl1fgy747MhjfYLcXFF4+IITqBw==
            -----END AGE ENCRYPTED FILE-----
    lastmodified: "2024-10-19T10:33:46Z"
    mac: ENC[AES256_GCM,data:HHpoinFP+wCsZo5+LnWlSmXFBI91bICtTma+qG/ubSQX5R4DrhFt2qJYddYr7epQv1Hg3H+yR+mbtw9xp4W1IRMm2c4kSiOwhihQG534gCKkMR4bmIgG+d23SiFPZWrc5ZgahetZISuqUoAmlRg332nR45pnfvxGuWy57YYsHZc=,iv:GBm905BTHMhe43lqSizk2gF/0gq8rAElzTRpY5MRjns=,tag:UVJlbA8T9ohQ4fc4vGTGRA==,type:str]
    pgp: []
    encrypted_regex: ((?i)(displayname|email|pass|ca|id|bootstraptoken|secretboxencryptionsecret|secrets|secrets|password|cert|secret($|[^N])|key|token|^data$|^stringData))
    version: 3.9.1
